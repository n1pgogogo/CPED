# 测试GPT标注准确率

先在微博以`大五人格`为关键词，检索到24位在微博上面分享自己的测评结果，不过用户进行大五人格测验是在不同平台进行的，所得到最后的分数也会不一致。所以我们最后只选取了测验最高分和用户得分为已知的情况下微博用户的大五人格特征。

筛选后得到12位有效的微博用户，再将得分除以总分，若大于0.5则该特质标注为高，否则该特质标注为低。

## GPT prompt

我们使用GPT4 API接口的形式进行批量标注。不过由于GPT4的token数量有限，所以当用户发博达到超出token数量，我们会进行切分，并对于该用户进行多次提问，以此得到多个结果。

GPT4所提交的完整对话如下：
```python
[{
    "role": "user",
    "content": """我会提供一段文本，该文本由一位人物在不同场景与不同谈话中所进行的对话组成，但仅包含该人物的说辞，对话内容由\\n分隔。
你需要依据神经质、外向性、开放性、宜人性、尽责性这五个维度分析该人物的人格特点，分析的时候你需要严格遵守下面的格式规范进行回答，且分析内容必须引用所给内容：
- [维度]: [对于该维度的分析内容]

> 其中开放性指个体对经验持开放、探求的态度。尽责性指个体在目标导向行为上的组织、坚持和动机。外向性指个体对外部世界的积极投入程度。宜人性指个体在合作与社会和谐性方面的差异。神经质指个体体验消极情绪的倾向。而且在分析完毕后，你还要给出分析的最终结果，结果只有高和低两个值，如果不知道就是不知道，以json格式保存，具体格式如下:{"神经质": "[高或低]","外向性": "[高或低]","开放性": "[高或低]","宜人性": "[高或低]","尽责性": "[高或低]"}
下面是我提供的文本: """ + message
}]
```

> message 是所提供的用户发博具体内容

最后我们得到的返回结果如下(下方是一个完整的回复)：
```markdown
- 神经质: 从文本中可以看出此人时常表现出焦虑、紧张和抱怨等特质，比如“受不了了，，，，，真的要死了”、“想死了，，，，，”，因此神经质较高。
- 外向性: 从文本中表述的日常生活、常常抱怨等内容来看，可能不太适应社交场合，所以外向性较低。
- 开放性: 文本中该人有时表现出对新事物的兴趣，如准备攒钱买一个拍立得，看了一圈iwatch表带等，可见开放性较高。
- 宜人性: 文本中此人经常表现出对他人的抱怨或埋怨，如“看到萌萌接了某小玩具广告（大人糖）想起这个品牌和小s解约背刺以表忠心，观感很复杂……所以对她们家东西有点恶感”，因此宜人性较低。
- 尽责性: 文本中此人在面对压力时也能坚持下去，如“因为石油分手崩溃大哭，被迫听了两小时的哭吼埋冤导致现在还没有睡觉但是明天满课的一薛牲一枚呀～我永远恨集体生活”，所以尽责性较高。

最终分析结果: {""神经质"": ""高"",""外向性"": ""低"",""开放性"": ""高"",""宜人性"": ""低"",""尽责性"": ""高""}"
```

> 注：尽管要求GPT回答的结果只能是 高或低，不过它有时候依旧会给出其余结果。

## 评估模型

预测大五人格，常采用的方式是在某一维度下，预测的准确率，所以我们采用准确率的方式来评估模型。
不过我们目前进行了两种计算准确率方式的比较，这是为了求得哪种方式最佳，以为后续对未知数据进行标注做准备。

### 1. 直接求解

这是遍历每个维度下所有样本的值，并判断是否相等，最终求得相等的概率即为准确率。

比如，下方是所有用户在神经质下所测的结果以及GPT的预测结果：
```
实际：[high, low, high, low]
预测：[low, unknown, medium, low]
```

这样的话，准确率为$\frac{0 + 0 + 0 + 1}{4} = 0.25$

最后所得结果为：
```
Neuroticism          0.739130
Extraversion         0.586957
Openness             0.891304
Agreeableness        0.586957
Conscientiousness    0.434783
```

### 2. 转换求解

先将所有数据进行转换，也就是把`高`转换为`1`，把`低`转换为`0`，其余回答全部转换为`NaN`，这样有利于后续计算。

之前也提到在预测集上是单用户有多个结果，当转换为`0, 1`的值后，就能进行分组求平均值，所得数值表示为当前用户被GPT预测为某一维度下为高的概率。

> 不过最后的目的是为了让结果呈现为二分类，所以将大于0.5的值转换为1，小于等于0.5的值转换为0，其中NaN值依旧是NaN。

求得平均值后，利用下述算法求得最后概率值：
$$
Q_j = 1 - \frac{1}{n}\sum_{i=1}^{n} | q_{truth}(i|j) - q_{pre}(i|j)|
$$
其中,
- `n`为样本数量。
- `Q_j`为大五人格的某一个维度被预测为高的概率。
- `j`为大五人格的某一维度
- $q_{truth}(i|j)$为该样本在某一维度上被评为高的概率，只有 `0` 或 `1`，也就是要么是高，要么不是高。
- $q_{pre}(i|j)$为该样本在预测某一维度上被评为高的概率，是一个连续值。越高即表明被预测为高的可能性越大。

> 由于可能还存在NaN的情况，所以当$q_{pre}(i|j) == NaN$的时候，$| q_{truth}(i|j) - q_{pre}(i|j)|$所得到的结果恒为0.5。因为该等式所得到值表示了$q_{truth}(i|j)$和$q_{pre}(i|j)$的差异大小。若该值为`1`，意味着真实值与预测值差异达到最大，相当于完全不同的结果，若该值为`0`，意味着预测值与真实值差异达到最小，相当于完全相同的结果。所以当值为`0.5`，预测值有一半的可能性与真实值不相同，另外一半的可能性与真实值相同，也就意味着预测不准确。

最终得到的准确率结果为：
```
Neuroticism	        0.70
Extraversion	    0.60
Openness	        1.00
Agreeableness	    0.80
Conscientiousness	0.65
```
